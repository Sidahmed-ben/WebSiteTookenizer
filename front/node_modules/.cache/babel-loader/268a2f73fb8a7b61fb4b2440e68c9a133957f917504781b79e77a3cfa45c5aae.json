{"ast":null,"code":"/*\n * Copyright (c) AXA Group Operations Spain S.A.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst {\n  Clonable,\n  compareWildcars\n} = require('@nlpjs/core');\nconst defaultDomainName = 'master_domain';\nclass DomainManager extends Clonable {\n  constructor() {\n    let settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let container = arguments.length > 1 ? arguments[1] : undefined;\n    super({\n      settings: {},\n      container: settings.container || container\n    }, container);\n    this.applySettings(this.settings, settings);\n    this.applySettings(this.settings, {\n      locale: 'en'\n    });\n    if (!this.settings.tag) {\n      this.settings.tag = `domain-manager-${this.settings.locale}`;\n    }\n    this.registerDefault();\n    this.applySettings(this.settings, this.container.getConfiguration(this.settings.tag));\n    this.domains = {};\n    this.addDomain(defaultDomainName);\n    this.stemDict = {};\n    this.intentDict = {};\n    this.sentences = [];\n    this.applySettings(this, {\n      pipelineTrain: this.getPipeline(`${this.settings.tag}-train`),\n      pipelineProcess: this.getPipeline(`${this.settings.tag}-process`)\n    });\n  }\n  registerDefault() {\n    this.container.registerConfiguration('domain-manager-??', {\n      nluByDomain: {\n        default: {\n          className: 'NeuralNlu',\n          settings: {}\n        }\n      },\n      trainByDomain: false,\n      useStemDict: true\n    }, false);\n    this.container.registerPipeline('domain-manager-??-train', ['.trainStemmer', '.generateCorpus', '.fillStemDict', '.innerTrain', 'output.status'], false);\n  }\n  getDomainInstance(domainName) {\n    if (!this.settings.nluByDomain) {\n      this.settings.nluByDomain = {};\n    }\n    const domainSettings = this.settings.nluByDomain[domainName] || this.settings.nluByDomain.default || {\n      className: 'NeuralNlu',\n      settings: {}\n    };\n    return this.container.get(domainSettings.className || 'NeuralNlu', this.applySettings({\n      locale: this.settings.locale\n    }, domainSettings.settings || {}));\n  }\n  addDomain(name) {\n    if (!this.domains[name]) {\n      this.domains[name] = this.getDomainInstance(name);\n    }\n    return this.domains[name];\n  }\n  removeDomain(name) {\n    delete this.domains[name];\n  }\n  async generateStemKey(srcTokens) {\n    let tokens;\n    if (typeof srcTokens !== 'string') {\n      tokens = srcTokens;\n    } else {\n      const input = await this.prepare({\n        utterance: srcTokens\n      });\n      tokens = await input.stems;\n    }\n    if (!Array.isArray(tokens)) {\n      tokens = Object.keys(tokens);\n    }\n    return tokens.slice().sort().join();\n  }\n  add(domain, utterance, intent) {\n    if (!intent) {\n      this.sentences.push({\n        domain: defaultDomainName,\n        utterance: domain,\n        intent: utterance\n      });\n    } else {\n      this.sentences.push({\n        domain,\n        utterance,\n        intent\n      });\n    }\n  }\n  remove(srcDomain, srcUtterance, srcIntent) {\n    const domain = srcIntent ? srcDomain : defaultDomainName;\n    const utterance = srcIntent ? srcUtterance : srcDomain;\n    const intent = srcIntent || srcUtterance;\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const sentence = this.sentences[i];\n      if (sentence.domain === domain && sentence.utterance === utterance && sentence.intent === intent) {\n        this.sentences.splice(i, 1);\n        return true;\n      }\n    }\n    return false;\n  }\n  async trainStemmer(srcInput) {\n    const input = srcInput;\n    if (!this.cache) {\n      this.cache = {\n        stem: this.container.get('stem')\n      };\n    }\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const current = this.sentences[i];\n      const subInput = {\n        ...current,\n        ...input\n      };\n      await this.cache.stem.addForTraining(subInput);\n    }\n    await this.cache.stem.train(input);\n    return input;\n  }\n  innerGenerateCorpus(domainName) {\n    this.intentDict = {};\n    const result = {};\n    result[defaultDomainName] = [];\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const sentence = this.sentences[i];\n      this.intentDict[sentence.intent] = sentence.domain;\n      const domain = domainName || sentence.domain;\n      if (!result[domain]) {\n        result[domain] = [];\n      }\n      const domainObj = result[domain];\n      domainObj.push({\n        utterance: sentence.utterance,\n        intent: sentence.intent\n      });\n      if (!domainName) {\n        result[defaultDomainName].push({\n          utterance: sentence.utterance,\n          intent: sentence.domain\n        });\n      }\n    }\n    return result;\n  }\n  async generateCorpus(srcInput) {\n    const input = srcInput;\n    input.corpus = this.innerGenerateCorpus(this.settings.trainByDomain ? undefined : defaultDomainName);\n    return input;\n  }\n  async prepare(srcInput) {\n    const input = srcInput;\n    const isString = typeof input === 'string';\n    const utterance = isString ? input : input.utterance;\n    const nlu = this.addDomain(defaultDomainName);\n    const tokens = nlu.prepare(utterance);\n    if (isString) {\n      return tokens;\n    }\n    input.stems = tokens;\n    return input;\n  }\n  async fillStemDict(srcInput) {\n    this.stemDict = {};\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const {\n        utterance,\n        intent,\n        domain\n      } = this.sentences[i];\n      const key = await this.generateStemKey(utterance);\n      if (!key || key === '') {\n        this.container.get('logger').warn(`This utterance: \"${utterance}\" contains only stop words`);\n      }\n      this.stemDict[key] = {\n        intent,\n        domain\n      };\n    }\n    return srcInput;\n  }\n  async innerTrain(srcInput) {\n    const input = srcInput;\n    const {\n      corpus\n    } = input;\n    const keys = Object.keys(corpus);\n    const status = {};\n    for (let i = 0; i < keys.length; i += 1) {\n      const nlu = this.addDomain(keys[i]);\n      const options = {\n        useNoneFeature: this.settings.useNoneFeature\n      };\n      if (srcInput.settings && srcInput.settings.log !== undefined) {\n        options.log = srcInput.settings.log;\n      }\n      const result = await nlu.train(corpus[keys[i]], options);\n      status[keys[i]] = result.status;\n    }\n    input.status = status;\n    return input;\n  }\n  async train(settings) {\n    const input = {\n      domainManager: this,\n      settings: settings || this.settings\n    };\n    return this.runPipeline(input, this.pipelineTrain);\n  }\n  matchAllowList(intent, allowList) {\n    for (let i = 0; i < allowList.length; i += 1) {\n      if (compareWildcars(intent, allowList[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n  async classifyByStemDict(utterance, domainName, allowList) {\n    const key = await this.generateStemKey(utterance);\n    const resolved = this.stemDict[key];\n    if (resolved && (!domainName || resolved.domain === domainName)) {\n      if (allowList && !this.matchAllowList(resolved.intent, allowList)) {\n        return undefined;\n      }\n      const classifications = [];\n      classifications.push({\n        intent: resolved.intent,\n        score: 1\n      });\n      const intents = Object.keys(this.intentDict);\n      for (let i = 0; i < intents.length; i += 1) {\n        if (intents[i] !== resolved.intent) {\n          classifications.push({\n            intent: intents[i],\n            score: 0\n          });\n        }\n      }\n      return {\n        domain: resolved.domain,\n        classifications\n      };\n    }\n    return undefined;\n  }\n  async innerClassify(srcInput, domainName) {\n    const input = srcInput;\n    const settings = this.applySettings({\n      ...input.settings\n    }, this.settings);\n    if (settings.useStemDict) {\n      const result = await this.classifyByStemDict(input.utterance, domainName, srcInput.settings ? srcInput.settings.allowList : undefined);\n      if (result) {\n        input.classification = result;\n        input.explanation = [{\n          token: '',\n          stem: '##exact',\n          weight: 1\n        }];\n        return input;\n      }\n    }\n    if (domainName) {\n      const nlu = this.domains[domainName];\n      if (!nlu) {\n        input.classification = {\n          domain: 'default',\n          classifications: [{\n            intent: 'None',\n            score: 1\n          }]\n        };\n        return input;\n      }\n      const nluAnswer = await nlu.process(input.utterance, input.settings || this.settings);\n      let classifications;\n      if (Array.isArray(nluAnswer)) {\n        classifications = nluAnswer;\n      } else {\n        classifications = nluAnswer.classifications;\n        input.nluAnswer = nluAnswer;\n      }\n      let finalDomain;\n      if (domainName === defaultDomainName) {\n        if (classifications && classifications.length) {\n          finalDomain = this.intentDict[classifications[0].intent];\n        } else {\n          finalDomain = defaultDomainName;\n        }\n      } else {\n        finalDomain = domainName;\n      }\n      input.classification = {\n        domain: finalDomain,\n        classifications\n      };\n      return input;\n    }\n    let domain = defaultDomainName;\n    if (input.settings.trainByDomain === undefined && this.settings.trainByDomain || input.settings.trainByDomain) {\n      const nlu = this.domains[defaultDomainName];\n      let classifications = await nlu.process(input.utterance);\n      if (classifications.classifications) {\n        classifications = classifications.classifications;\n      }\n      if (Object.keys(this.domains).length === 1) {\n        input.classification = {\n          domain: 'default',\n          classifications\n        };\n        return input;\n      }\n      domain = classifications[0].intent;\n      if (domain === 'None') {\n        input.classification = {\n          domain: 'default',\n          classifications: [{\n            intent: 'None',\n            score: 1\n          }]\n        };\n        return input;\n      }\n    }\n    return this.innerClassify(input, domain);\n  }\n  async defaultPipelineProcess(input) {\n    const output = await this.innerClassify(input);\n    return output.classification;\n  }\n  async process(utterance, settings) {\n    const input = typeof utterance === 'string' ? {\n      utterance,\n      settings: settings || this.settings\n    } : utterance;\n    if (this.pipelineProcess) {\n      return this.runPipeline(input, this.pipelineProcess);\n    }\n    return this.defaultPipelineProcess(input);\n  }\n  toJSON() {\n    const result = {\n      settings: this.settings,\n      stemDict: this.stemDict,\n      intentDict: this.intentDict,\n      sentences: this.sentences,\n      domains: {}\n    };\n    delete result.settings.container;\n    const keys = Object.keys(this.domains);\n    for (let i = 0; i < keys.length; i += 1) {\n      result.domains[keys[i]] = this.domains[keys[i]].toJSON();\n    }\n    return result;\n  }\n  fromJSON(json) {\n    this.applySettings(this.settings, json.settings);\n    this.stemDict = json.stemDict;\n    this.intentDict = json.intentDict;\n    this.sentences = json.sentences;\n    const keys = Object.keys(json.domains);\n    for (let i = 0; i < keys.length; i += 1) {\n      const domain = this.addDomain(keys[i]);\n      domain.fromJSON(json.domains[keys[i]]);\n    }\n  }\n}\nmodule.exports = DomainManager;","map":{"version":3,"names":["Clonable","compareWildcars","require","defaultDomainName","DomainManager","constructor","settings","arguments","length","undefined","container","applySettings","locale","tag","registerDefault","getConfiguration","domains","addDomain","stemDict","intentDict","sentences","pipelineTrain","getPipeline","pipelineProcess","registerConfiguration","nluByDomain","default","className","trainByDomain","useStemDict","registerPipeline","getDomainInstance","domainName","domainSettings","get","name","removeDomain","generateStemKey","srcTokens","tokens","input","prepare","utterance","stems","Array","isArray","Object","keys","slice","sort","join","add","domain","intent","push","remove","srcDomain","srcUtterance","srcIntent","i","sentence","splice","trainStemmer","srcInput","cache","stem","current","subInput","addForTraining","train","innerGenerateCorpus","result","domainObj","generateCorpus","corpus","isString","nlu","fillStemDict","key","warn","innerTrain","status","options","useNoneFeature","log","domainManager","runPipeline","matchAllowList","allowList","classifyByStemDict","resolved","classifications","score","intents","innerClassify","classification","explanation","token","weight","nluAnswer","process","finalDomain","defaultPipelineProcess","output","toJSON","fromJSON","json","module","exports"],"sources":["/home/sidahmed/Bureau/Cours_Master_1/S2/Web/Partie2/MoteurRecherche/moteur-rech/node_modules/@nlpjs/nlu/src/domain-manager.js"],"sourcesContent":["/*\n * Copyright (c) AXA Group Operations Spain S.A.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst { Clonable, compareWildcars } = require('@nlpjs/core');\n\nconst defaultDomainName = 'master_domain';\n\nclass DomainManager extends Clonable {\n  constructor(settings = {}, container) {\n    super(\n      {\n        settings: {},\n        container: settings.container || container,\n      },\n      container\n    );\n    this.applySettings(this.settings, settings);\n    this.applySettings(this.settings, { locale: 'en' });\n    if (!this.settings.tag) {\n      this.settings.tag = `domain-manager-${this.settings.locale}`;\n    }\n    this.registerDefault();\n    this.applySettings(\n      this.settings,\n      this.container.getConfiguration(this.settings.tag)\n    );\n    this.domains = {};\n    this.addDomain(defaultDomainName);\n    this.stemDict = {};\n    this.intentDict = {};\n    this.sentences = [];\n    this.applySettings(this, {\n      pipelineTrain: this.getPipeline(`${this.settings.tag}-train`),\n      pipelineProcess: this.getPipeline(`${this.settings.tag}-process`),\n    });\n  }\n\n  registerDefault() {\n    this.container.registerConfiguration(\n      'domain-manager-??',\n      {\n        nluByDomain: {\n          default: {\n            className: 'NeuralNlu',\n            settings: {},\n          },\n        },\n        trainByDomain: false,\n        useStemDict: true,\n      },\n      false\n    );\n    this.container.registerPipeline(\n      'domain-manager-??-train',\n      [\n        '.trainStemmer',\n        '.generateCorpus',\n        '.fillStemDict',\n        '.innerTrain',\n        'output.status',\n      ],\n      false\n    );\n  }\n\n  getDomainInstance(domainName) {\n    if (!this.settings.nluByDomain) {\n      this.settings.nluByDomain = {};\n    }\n    const domainSettings = this.settings.nluByDomain[domainName] ||\n      this.settings.nluByDomain.default || {\n        className: 'NeuralNlu',\n        settings: {},\n      };\n    return this.container.get(\n      domainSettings.className || 'NeuralNlu',\n      this.applySettings(\n        { locale: this.settings.locale },\n        domainSettings.settings || {}\n      )\n    );\n  }\n\n  addDomain(name) {\n    if (!this.domains[name]) {\n      this.domains[name] = this.getDomainInstance(name);\n    }\n    return this.domains[name];\n  }\n\n  removeDomain(name) {\n    delete this.domains[name];\n  }\n\n  async generateStemKey(srcTokens) {\n    let tokens;\n    if (typeof srcTokens !== 'string') {\n      tokens = srcTokens;\n    } else {\n      const input = await this.prepare({ utterance: srcTokens });\n      tokens = await input.stems;\n    }\n    if (!Array.isArray(tokens)) {\n      tokens = Object.keys(tokens);\n    }\n    return tokens.slice().sort().join();\n  }\n\n  add(domain, utterance, intent) {\n    if (!intent) {\n      this.sentences.push({\n        domain: defaultDomainName,\n        utterance: domain,\n        intent: utterance,\n      });\n    } else {\n      this.sentences.push({ domain, utterance, intent });\n    }\n  }\n\n  remove(srcDomain, srcUtterance, srcIntent) {\n    const domain = srcIntent ? srcDomain : defaultDomainName;\n    const utterance = srcIntent ? srcUtterance : srcDomain;\n    const intent = srcIntent || srcUtterance;\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const sentence = this.sentences[i];\n      if (\n        sentence.domain === domain &&\n        sentence.utterance === utterance &&\n        sentence.intent === intent\n      ) {\n        this.sentences.splice(i, 1);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  async trainStemmer(srcInput) {\n    const input = srcInput;\n    if (!this.cache) {\n      this.cache = {\n        stem: this.container.get('stem'),\n      };\n    }\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const current = this.sentences[i];\n      const subInput = { ...current, ...input };\n      await this.cache.stem.addForTraining(subInput);\n    }\n    await this.cache.stem.train(input);\n    return input;\n  }\n\n  innerGenerateCorpus(domainName) {\n    this.intentDict = {};\n    const result = {};\n    result[defaultDomainName] = [];\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const sentence = this.sentences[i];\n      this.intentDict[sentence.intent] = sentence.domain;\n      const domain = domainName || sentence.domain;\n      if (!result[domain]) {\n        result[domain] = [];\n      }\n      const domainObj = result[domain];\n      domainObj.push({\n        utterance: sentence.utterance,\n        intent: sentence.intent,\n      });\n      if (!domainName) {\n        result[defaultDomainName].push({\n          utterance: sentence.utterance,\n          intent: sentence.domain,\n        });\n      }\n    }\n    return result;\n  }\n\n  async generateCorpus(srcInput) {\n    const input = srcInput;\n    input.corpus = this.innerGenerateCorpus(\n      this.settings.trainByDomain ? undefined : defaultDomainName\n    );\n    return input;\n  }\n\n  async prepare(srcInput) {\n    const input = srcInput;\n    const isString = typeof input === 'string';\n    const utterance = isString ? input : input.utterance;\n    const nlu = this.addDomain(defaultDomainName);\n    const tokens = nlu.prepare(utterance);\n    if (isString) {\n      return tokens;\n    }\n    input.stems = tokens;\n    return input;\n  }\n\n  async fillStemDict(srcInput) {\n    this.stemDict = {};\n    for (let i = 0; i < this.sentences.length; i += 1) {\n      const { utterance, intent, domain } = this.sentences[i];\n      const key = await this.generateStemKey(utterance);\n      if (!key || key === '') {\n        this.container\n          .get('logger')\n          .warn(`This utterance: \"${utterance}\" contains only stop words`);\n      }\n      this.stemDict[key] = {\n        intent,\n        domain,\n      };\n    }\n    return srcInput;\n  }\n\n  async innerTrain(srcInput) {\n    const input = srcInput;\n    const { corpus } = input;\n    const keys = Object.keys(corpus);\n    const status = {};\n    for (let i = 0; i < keys.length; i += 1) {\n      const nlu = this.addDomain(keys[i]);\n      const options = { useNoneFeature: this.settings.useNoneFeature };\n      if (srcInput.settings && srcInput.settings.log !== undefined) {\n        options.log = srcInput.settings.log;\n      }\n      const result = await nlu.train(corpus[keys[i]], options);\n      status[keys[i]] = result.status;\n    }\n    input.status = status;\n    return input;\n  }\n\n  async train(settings) {\n    const input = {\n      domainManager: this,\n      settings: settings || this.settings,\n    };\n    return this.runPipeline(input, this.pipelineTrain);\n  }\n\n  matchAllowList(intent, allowList) {\n    for (let i = 0; i < allowList.length; i += 1) {\n      if (compareWildcars(intent, allowList[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  async classifyByStemDict(utterance, domainName, allowList) {\n    const key = await this.generateStemKey(utterance);\n    const resolved = this.stemDict[key];\n    if (resolved && (!domainName || resolved.domain === domainName)) {\n      if (allowList && !this.matchAllowList(resolved.intent, allowList)) {\n        return undefined;\n      }\n      const classifications = [];\n      classifications.push({\n        intent: resolved.intent,\n        score: 1,\n      });\n      const intents = Object.keys(this.intentDict);\n      for (let i = 0; i < intents.length; i += 1) {\n        if (intents[i] !== resolved.intent) {\n          classifications.push({ intent: intents[i], score: 0 });\n        }\n      }\n      return { domain: resolved.domain, classifications };\n    }\n    return undefined;\n  }\n\n  async innerClassify(srcInput, domainName) {\n    const input = srcInput;\n    const settings = this.applySettings({ ...input.settings }, this.settings);\n    if (settings.useStemDict) {\n      const result = await this.classifyByStemDict(\n        input.utterance,\n        domainName,\n        srcInput.settings ? srcInput.settings.allowList : undefined\n      );\n      if (result) {\n        input.classification = result;\n        input.explanation = [\n          {\n            token: '',\n            stem: '##exact',\n            weight: 1,\n          },\n        ];\n        return input;\n      }\n    }\n    if (domainName) {\n      const nlu = this.domains[domainName];\n      if (!nlu) {\n        input.classification = {\n          domain: 'default',\n          classifications: [{ intent: 'None', score: 1 }],\n        };\n        return input;\n      }\n      const nluAnswer = await nlu.process(\n        input.utterance,\n        input.settings || this.settings\n      );\n      let classifications;\n      if (Array.isArray(nluAnswer)) {\n        classifications = nluAnswer;\n      } else {\n        classifications = nluAnswer.classifications;\n        input.nluAnswer = nluAnswer;\n      }\n      let finalDomain;\n      if (domainName === defaultDomainName) {\n        if (classifications && classifications.length) {\n          finalDomain = this.intentDict[classifications[0].intent];\n        } else {\n          finalDomain = defaultDomainName;\n        }\n      } else {\n        finalDomain = domainName;\n      }\n      input.classification = {\n        domain: finalDomain,\n        classifications,\n      };\n      return input;\n    }\n    let domain = defaultDomainName;\n    if (\n      (input.settings.trainByDomain === undefined &&\n        this.settings.trainByDomain) ||\n      input.settings.trainByDomain\n    ) {\n      const nlu = this.domains[defaultDomainName];\n      let classifications = await nlu.process(input.utterance);\n      if (classifications.classifications) {\n        classifications = classifications.classifications;\n      }\n      if (Object.keys(this.domains).length === 1) {\n        input.classification = {\n          domain: 'default',\n          classifications,\n        };\n        return input;\n      }\n      domain = classifications[0].intent;\n      if (domain === 'None') {\n        input.classification = {\n          domain: 'default',\n          classifications: [{ intent: 'None', score: 1 }],\n        };\n        return input;\n      }\n    }\n    return this.innerClassify(input, domain);\n  }\n\n  async defaultPipelineProcess(input) {\n    const output = await this.innerClassify(input);\n    return output.classification;\n  }\n\n  async process(utterance, settings) {\n    const input =\n      typeof utterance === 'string'\n        ? {\n            utterance,\n            settings: settings || this.settings,\n          }\n        : utterance;\n    if (this.pipelineProcess) {\n      return this.runPipeline(input, this.pipelineProcess);\n    }\n    return this.defaultPipelineProcess(input);\n  }\n\n  toJSON() {\n    const result = {\n      settings: this.settings,\n      stemDict: this.stemDict,\n      intentDict: this.intentDict,\n      sentences: this.sentences,\n      domains: {},\n    };\n    delete result.settings.container;\n    const keys = Object.keys(this.domains);\n    for (let i = 0; i < keys.length; i += 1) {\n      result.domains[keys[i]] = this.domains[keys[i]].toJSON();\n    }\n    return result;\n  }\n\n  fromJSON(json) {\n    this.applySettings(this.settings, json.settings);\n    this.stemDict = json.stemDict;\n    this.intentDict = json.intentDict;\n    this.sentences = json.sentences;\n    const keys = Object.keys(json.domains);\n    for (let i = 0; i < keys.length; i += 1) {\n      const domain = this.addDomain(keys[i]);\n      domain.fromJSON(json.domains[keys[i]]);\n    }\n  }\n}\n\nmodule.exports = DomainManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}